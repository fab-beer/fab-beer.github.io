---

layout: default
title: Find our cans
id: find
style: main

---

<link rel="stylesheet" href="/deps/autocomplete.css">
<script src="https://cdn.jsdelivr.net/npm/tinyqueue@2.0.3/tinyqueue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/rbush@3.0.1/rbush.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.14.2/matter.min.js" 
integrity="sha256-Bmvb4pJWin8rqq3GnwPz/hxBtqXaMdZHJnHYlpRULa4=" 
crossorigin="anonymous"
></script>

<script src="https://cdn.jsdelivr.net/npm/matter-wrap@0.2.0/build/matter-wrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/matter-attractors@0.1.6/build/matter-attractors.min.js"></script>
<script type="text/javascript" src="/find-physics.js" ></script>
<script type="text/javascript" src="/find.js" ></script>


<script type="text/javascript" src="deps/autocomplete.min.js"></script>



{% include google-map-2.html %}



<div class="physics"></div>


<span class="account-type find-hud-top">
    <form >


    <div class="label-group valentines">
        
        TREMENDOUS & P4P Launch 2/14<br/>  <a href="/feb14">Click here</a> for launch locations!
    </div>

        <span class="filters">
        <span class="label-group onprem">
            <input id="show-onprem" type="checkbox"/>
        <label class="account-checkbox-label" for="show-onprem">
            <svg version="1.1" class="glass icon" id="teku" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            viewBox="0 0 85.72 188.09" style="enable-background:new 0 0 85.72 188.09;" xml:space="preserve">
       <g>
           <g>
               <g>
                   <path d="M54.5,172.37l-5.85-4.55l-2.28-5.2l1.3-43.26l7.16-20.82l30.9-21.14L69.46,14.96l2.28-8.78h-6.81H20.8h-6.81l2.28,8.78
                       L0,77.41l30.9,21.14l7.16,20.82l1.3,43.26l-2.28,5.2l-5.85,4.55l-20.82,5.85c0,0-2.28,3.58-1.3,3.9
                       c0.98,0.33,18.21,6.83,33.82,5.85h2.86c15.61,0.98,29.85-5.53,30.82-5.85c0.98-0.33-1.3-3.9-1.3-3.9L54.5,172.37z M18.16,24.67
                       l1.82-9.54l-1.82-6.36h48.9l-2.73,6.36l3.63,9.54H18.16z"/>
               </g>
           </g>
           <g>
               <path d="M19.37,3.45H63.5h1.68C57.85,2.7,50.14,0,42.17,0S26.49,2.7,19.16,3.45H19.37z"/>
           </g>
       </g>
       </svg>
        </label>
    </span>

    
    <span class="label-group offprem">
        <input id="show-offprem" type="checkbox"/>
        <label class="account-checkbox-label" for="show-offprem">
            <svg id="gift" class="gift icon" height='100px' width='100px' xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><g><path d="M73.23,25.663h-9.431c1.829-1.444,3.455-3.402,4.787-5.733c4.001-7.001,3.874-14.604-3.129-18.605   C60.218-1.669,54.316,0.765,50,5.113c-4.316-4.348-10.219-6.783-15.458-3.789c-7.002,4.001-7.129,11.604-3.128,18.605   c1.332,2.331,2.958,4.289,4.787,5.733H26.77c-7.698,0-13.938,6.24-13.938,13.938v17.92v10.62v17.921   c0,7.698,6.24,13.938,13.938,13.938h17.92h10.62H73.23c7.698,0,13.938-6.24,13.938-13.938V68.141v-10.62v-17.92   C87.169,31.903,80.929,25.663,73.23,25.663z M18.153,39.601c0-4.751,3.865-8.616,8.616-8.616h17.92v26.537H18.153V39.601z    M26.77,94.678c-4.751,0-8.616-3.865-8.616-8.616V68.141H44.69v26.537H26.77z M81.847,86.062c0,4.751-3.865,8.616-8.616,8.616   H55.31V68.141h26.537V86.062z M55.31,57.521V30.985H73.23c4.751,0,8.616,3.865,8.616,8.616v17.92H55.31z"></path></g></svg>
        </label>
    </span>
    <span class="label-group noballoons">
        <input id="noballoons" type="checkbox"/>
        <label class="account-checkbox-label" for="noballoons">
            <svg id="noballoon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 434.45 448.49"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#231f20;}</style></defs><title>noballoon</title><path d="M178.4,107c11.07,1.34-15.66,36.11,44.44,27.25,33.81,2.21,61.27,27.76,99.3,34.73,12.27,8,48.38-25.17,32.16,3.89-5.37,17.33-29.89,23.51-38.74,37-1,1.69,14.22,31.41-17.17,92.64-12.84,30.4-71.44,32.25-82.22,63.77,27.39,4.44-13.35,31.13-14,10.61,42-45.95-112.34-49.79-119.51-88.92,2-.23-17.61-20.53-6.17-18.8,22.69,1.25,6.5-20.57,32.29-87,3.63-4.14,23.56-21.13,26.9-32.78.24-.72-22.34-14.86-13.46-23.94C135.78,107.55,129.4,197,178.4,107Zm-17.33,36h0C161.5,142.53,159.05,141.87,161.07,143Zm-8.83,2.68c-.53-.33-.33-.74-1.36.48C151.44,146.42,151.17,146.65,152.24,145.68Z"/><path class="cls-1" d="M161.07,143h0C161.21,143.52,157.48,143.89,161.07,143Z"/><path class="cls-1" d="M152.24,145.68h0C152.39,145.89,149.69,147.22,152.24,145.68Z"/><path class="cls-2" d="M212.84,431.67c-106.41,0-193-86.57-193-193s86.58-193,193-193,193,86.57,193,193S319.25,431.67,212.84,431.67Zm0-356c-89.87,0-163,73.11-163,163s73.12,163,163,163,163-73.11,163-163S302.71,75.71,212.84,75.71Z"/><path class="cls-2" d="M62.4,51.75,210,199.37l142-142,37.69,37.69-142,142L396.57,385.93l-40.2,40.2L207.5,277.26l-142,142L27.85,381.53l142-142L22.19,92Z"/></svg>
        </label>
    </span>
</span>


    <span class="label-group search">



    <input id="venue-search" placeholder="Somerville, MA" type="search"/>

    <script>

onprem_svg = `<svg version="1.1" class="glass icon" id="teku" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            viewBox="0 0 85.72 188.09" style="enable-background:new 0 0 85.72 188.09;" xml:space="preserve">
       <g>
           <g>
               <g>
                   <path d="M54.5,172.37l-5.85-4.55l-2.28-5.2l1.3-43.26l7.16-20.82l30.9-21.14L69.46,14.96l2.28-8.78h-6.81H20.8h-6.81l2.28,8.78
                       L0,77.41l30.9,21.14l7.16,20.82l1.3,43.26l-2.28,5.2l-5.85,4.55l-20.82,5.85c0,0-2.28,3.58-1.3,3.9
                       c0.98,0.33,18.21,6.83,33.82,5.85h2.86c15.61,0.98,29.85-5.53,30.82-5.85c0.98-0.33-1.3-3.9-1.3-3.9L54.5,172.37z M18.16,24.67
                       l1.82-9.54l-1.82-6.36h48.9l-2.73,6.36l3.63,9.54H18.16z"/>
               </g>
           </g>
           <g>
               <path d="M19.37,3.45H63.5h1.68C57.85,2.7,50.14,0,42.17,0S26.49,2.7,19.16,3.45H19.37z"/>
           </g>
       </g>
       </svg>`

offprem_svg = ` <svg id="gift" class="gift icon" height='100px' width='100px' xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><g><path d="M73.23,25.663h-9.431c1.829-1.444,3.455-3.402,4.787-5.733c4.001-7.001,3.874-14.604-3.129-18.605   C60.218-1.669,54.316,0.765,50,5.113c-4.316-4.348-10.219-6.783-15.458-3.789c-7.002,4.001-7.129,11.604-3.128,18.605   c1.332,2.331,2.958,4.289,4.787,5.733H26.77c-7.698,0-13.938,6.24-13.938,13.938v17.92v10.62v17.921   c0,7.698,6.24,13.938,13.938,13.938h17.92h10.62H73.23c7.698,0,13.938-6.24,13.938-13.938V68.141v-10.62v-17.92   C87.169,31.903,80.929,25.663,73.23,25.663z M18.153,39.601c0-4.751,3.865-8.616,8.616-8.616h17.92v26.537H18.153V39.601z    M26.77,94.678c-4.751,0-8.616-3.865-8.616-8.616V68.141H44.69v26.537H26.77z M81.847,86.062c0,4.751-3.865,8.616-8.616,8.616   H55.31V68.141h26.537V86.062z M55.31,57.521V30.985H73.23c4.751,0,8.616,3.865,8.616,8.616v17.92H55.31z"></path></g></svg>`


var input = document.getElementById("venue-search");

autocomplete({
    showOnFocus:true,
input: input,
render:(item)=>{

var e = item.value;
    if("venue" in e){
        return $(
        `<span class="result onprem">
            ${onprem_svg}/<img class="balloon" src="/assets/balloons/small-heads_${e.can.code}.png"/>
            <span class="name">${e.venue.venue_name}</span>,
            <span class="city">${e.venue.venue_city}</span> <span class="latlng">(${parseFloat(e.venue.lat).toFixed(2)+"°N " + 
        parseFloat(e.venue.lng).toFixed(2) + "°E"})</span>
            </span>
        ` )[0]
    } else{

        return $(
        `<span class="result offprem">
            ${offprem_svg}/<img class="balloon" src="/assets/balloons/small-heads_${e.can.code}.png"/>
            <span class="name">[COMING 2/14] ${e.packy.company}</span>,
            <span class="city">${e.packy.city}</span> <span class="latlng">(${parseFloat(e.packy.lat).toFixed(2)+"°N " + 
        parseFloat(e.packy.lng).toFixed(2) + "°E"})</span>
            </span>
        ` )[0]
    }
},
fetch: function(text, update) {
    text = text.toLowerCase();
    // you can also use AJAX requests instead of preloaded data
    var suggestions = []

    console.log(text)
    if (text.startsWith("geo:")){
        latlng = /([\-\d\.]+)[^\-0-9]*([\-\d\.]+)[^\-0-9]*([\-\d\.]+)/.exec(text)
        
        lat = Number(latlng[1])
        lng = Number(latlng[2])
        threshold = Number(latlng[3])
        console.log(threshold)
        for (k in anchors){

distfun = (e)=>((e.venue.lat  - lat)**2 +(e.venue.lng - lng)**2)**.5  ;
a0 = anchors[k][0]


console.log(a0)
console.log(distfun(a0))
console.log(lat,lng)
console.log(a0.venue.lng -lng )
found = anchors[k].filter(e=>distfun(e)<(threshold/30))
if (found.length > 0){
    suggestions = suggestions.concat(found.map((e)=>{return{value:e}}))
}                
}

for (k in packy_anchors){
  
distfun = (e)=>((e.packy.lat  - lat)**2 +(e.packy.lng - lng)**2)**.5  ;
found = packy_anchors[k].filter(e=>distfun(e)<(threshold/30))
if (found.length > 0){
    suggestions = suggestions.concat(found.map((e)=>{return{value:e}}))
}            
            
}

    } else{


    
    for (k in anchors){

        strfun = (e)=>e.venue.venue_name + e.venue.venue_city + e.can.name;
        found = anchors[k].filter(e=>strfun(e).toLowerCase().includes(text))
        if (found.length > 0){
            suggestions = suggestions.concat(found.map((e)=>{return{value:e}}))
        }                
    }

    for (k in packy_anchors){
        strfun = (e)=>e.packy.company + e.packy.city + e.can.name;
        found = packy_anchors[k].filter(e=>strfun(e).toLowerCase().includes(text))
        if (found.length > 0){
            suggestions = suggestions.concat(found.map((e)=>{return{value:e}}))
        }                
    }
    }
    
   
   


    update(suggestions);
},
onSelect: function(item) {
    input.value = item.label;
}
});
</script>
</span>

<span class="label-group location inactive">
    <input type="button" id="enable-location" class="location" value="🌍 FAB near me!"/>
    <span class="location" id="location-update">... searching</span>

</span>


<script>
    
    $(document).on("click", "#location-update",(e)=>{
        console.log("CLICKED");
        getLocation()
    });
    var x = document.getElementById("location-update");
    function getLocation() {

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition
        , function(error) {         
            console.log(error)  
        //  switch(error.code) {
        //    case error.PERMISSION_DENIED:
        //      result.innerHTML = "Denied request for Geolocation."
        //      break;
        //    case error.POSITION_UNAVAILABLE:
        //      result.innerHTML = "Location unavailable."
        //      break;
        //   case error.TIMEOUT:
        //      result.innerHTML = "Location request timed out." 
        //      break;
        //   case error.UNKNOWN_ERROR:
        //      result.innerHTML = "An unknown error occurred."
        //      break;
        //  }
       }); 
      } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
      }
    }
    
    function showPosition(position) {
        console.log("HELLO!")
      x.innerHTML = "(" +parseFloat(position.coords.latitude).toFixed(0)+"°N " + 
        parseFloat(position.coords.longitude).toFixed(0) + "°E" +")";
      window.user_location = position
      $(".location").removeClass("inactive")
    }
    </script>


    </form>
</input>


    <script>
        $(window.setTimeout(()=>{
            
            getLocation()
            $("#show-offprem").prop("checked",true)
            $("#show-onprem").prop("checked",true)
            $("#show-offprem").trigger("change")
            $("#show-onprem").trigger("change")

        },500))

        $(document).on("click", "#enable-location",(e)=>{
            $("#venue-search").val("GEO: " +parseFloat(window.user_location.coords.latitude).toFixed(2)+"°N " + 
        parseFloat(window.user_location.coords.longitude).toFixed(2) + "°E +" +"25mi");
        $("#venue-search").trigger("change");
        $("#venue-search").focus()

        })
    
        $(document).on("change", "#show-onprem",(e)=>{
            var shown=  $(e.currentTarget).prop("checked")
            if(window.addType){shown ? addType("onprem") :releaseType("onprem")}
            $.each(_markers,(i,m)=>{ if (m.venue){ m.setVisible(shown)}})
         })
         $(document).on("change","#noballoons",(e)=>{
             console.log("HELLO")
            var shown=  $(e.currentTarget).prop("checked")
            $("body").toggleClass("noballoons",shown)
            window.pauseEngine(shown)
         })

        $(document).on("change", "#show-offprem",(e)=>{
            var shown=  $(e.currentTarget).prop("checked")
            if(window.addType){shown ? addType("offprem") :releaseType("offprem")}
            $.each(_markers,(i,m)=>{ if (m.packy){ m.setVisible(shown)}})
                
        })
            
    </script>
</div>

<div class="account-search find-hud-bottom">

</div>

<div class="row">
<div class="col-6 col-md-4 offset-md-1 find-hud">
    <h3>
       FAB Places
    </h3>
    <p>
        This map is live-generated from your Untappd check-ins at bars and restaurants and live wind maps from the National Weather Service. Thanks weather geeks. Fly safe!</p><p>Fans: To join our featured tasters group and get a free SQUIDDIE sticker, check out: <a href="fab.beer/sticky">fab.beer/sticky</a>.<p>New accounts: to get FAB on draft, email <a href="mailto:david@fab.beer">david@fab.beer</a>. Package store locations coming soon. --BEN & DAVE
        </p>
    
    <div class="find-scroll-container">
        {% assign venue_beers_sorted = site.data.venue_beers | sort: "venue_slug"  %}
        {% assign venue_beers_grouped = venue_beers_sorted | group_by: "venue_slug"  %}

        {% for group in venue_beers_grouped   %}
        {% for v in group.items %}

        <li class="venue" id="venue-{{v.venue_id}}">
            <div class="row venue-item">
                <div class="col-2 line venue-beer">
                    <ul class="beer-icon-list">
                        {% for c in site.data.cans %}
                        {% if c.code == v.can_code %}
                        <li><a href="/{{c.code}}"><img src="assets/balloons/small-heads_{{c.code}}.png"/></a> <!--[{{v.n_checkins}}]--></li>
                        {% endif %}
                        {% endfor %}
                    </ul> 
                </div>
                <div class="col-10  venue-info">
                    <span class="line venue-name"><a href="{{v.venue_url}}">{{v.venue_name}}</a></span>
                    <span class="line venue-city">{{v.venue_city}}, {{v.venue_state}} {{v.venue_country}}</span>

                    {% for c in site.data.cans %}
                    {% if c.code == v.can_code %}
                    <span class="line venue-checkin">
                           <img class="last-seen-icon" src="assets/balloons/small-heads_{{c.code}}.png"/> Last seen {{v.last_checkin | slice: 0,10}}
                        </span>
                    {% endif %}
                    {% endfor %}
                    
                </div>
            </div>          
        </li>    
        {% endfor %}
        {% endfor %}
    </div>
</div>
</div>